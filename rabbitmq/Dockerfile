FROM debian:bookworm

RUN apt update && apt upgrade -y

COPY ./tools/install.sh .

RUN chmod u+x install.sh && ./install.sh

COPY ./conf/rabbitmq.conf /etc/rabbitmq/rabbitmq.conf

ARG RABBITMQ_NODENAME=${RABBITMQ_NODENAME}
ARG RABBITMQ_API_GATEWAY_USER=${RABBITMQ_API_GATEWAY_USER}
ARG RABBITMQ_API_GATEWAY_PASSWORD=${RABBITMQ_API_GATEWAY_PASSWORD}
ARG RABBITMQ_USER_MANAGER_USER=${RABBITMQ_USER_MANAGER_USER}
ARG RABBITMQ_USER_MANAGER_PASSWORD=${RABBITMQ_USER_MANAGER_PASSWORD}

COPY ./tools/run.sh .

RUN chmod u+x run.sh

EXPOSE 5577

ENTRYPOINT [ "./run.sh" ]
